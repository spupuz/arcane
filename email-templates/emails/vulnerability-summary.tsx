import { Column, Hr, Row, Section, Text } from '@react-email/components';
import { BaseTemplate } from '../components/base-template';
import CardHeader from '../components/card-header';
import { sharedPreviewProps, sharedTemplateProps } from '../props';

interface VulnerabilitySummaryEmailProps {
  logoURL: string;
  appURL: string;
  summaryLabel: string;
  overview: string;
  fixableCount: string;
  severityBreakdown: string;
  sampleCVEs?: string;
}

export const VulnerabilitySummaryEmail = ({
  logoURL,
  appURL,
  summaryLabel,
  overview,
  fixableCount,
  severityBreakdown,
  sampleCVEs,
}: VulnerabilitySummaryEmailProps) => {
  return (
    <BaseTemplate logoURL={logoURL} appURL={appURL}>
      <CardHeader title="Daily Vulnerability Summary" />

      <Section style={{ marginTop: '16px' }}>
        <Text style={subTitleStyle}>{summaryLabel}</Text>
      </Section>

      <Section style={infoSectionStyle}>
        <Row style={infoRowStyle}>
          <Column style={labelColumnStyle}>
            <Text style={labelStyle}>Overview:</Text>
          </Column>
          <Column>
            <Text style={valueStyle}>{overview}</Text>
          </Column>
        </Row>

        <Hr style={dividerStyle} />

        <Row style={infoRowStyle}>
          <Column style={labelColumnStyle}>
            <Text style={labelStyle}>Fixable vulnerabilities:</Text>
          </Column>
          <Column>
            <Text style={fixedVersionStyle}>{fixableCount}</Text>
          </Column>
        </Row>

        <Hr style={dividerStyle} />

        <Row style={infoRowStyle}>
          <Column style={labelColumnStyle}>
            <Text style={labelStyle}>Severity breakdown:</Text>
          </Column>
          <Column>
            <Text style={valueStyle}>{severityBreakdown}</Text>
          </Column>
        </Row>

        <Hr style={dividerStyle} />

        <Row style={infoRowStyle}>
          <Column style={labelColumnStyle}>
            <Text style={labelStyle}>Sample CVEs:</Text>
          </Column>
          <Column>
            <Text style={valueStyle}>{sampleCVEs}</Text>
          </Column>
        </Row>
      </Section>

      <Section style={{ marginTop: '24px' }}>
        <Text style={footerStyle}>Open Arcane to review full vulnerability details and remediation actions.</Text>
      </Section>
    </BaseTemplate>
  );
};

export default VulnerabilitySummaryEmail;

const subTitleStyle = {
  fontSize: '14px',
  lineHeight: '22px',
  color: '#94a3b8',
  margin: '0',
};

const infoSectionStyle = {
  marginTop: '20px',
  backgroundColor: 'rgba(15, 23, 42, 0.5)',
  border: '1px solid rgba(148, 163, 184, 0.1)',
  padding: '20px',
  borderRadius: '12px',
};

const infoRowStyle = {
  marginBottom: '0',
};

const labelColumnStyle = {
  width: '170px',
  verticalAlign: 'top' as const,
  paddingRight: '12px',
};

const labelStyle = {
  fontSize: '14px',
  fontWeight: '600' as const,
  color: '#94a3b8',
  margin: '8px 0',
};

const valueStyle = {
  fontSize: '14px',
  color: '#e2e8f0',
  margin: '8px 0',
  wordBreak: 'break-word' as const,
};

const fixedVersionStyle = {
  fontSize: '14px',
  fontWeight: '600' as const,
  color: '#34d399',
  margin: '8px 0',
  wordBreak: 'break-word' as const,
};

const dividerStyle = {
  borderColor: 'rgba(148, 163, 184, 0.2)',
  margin: '4px 0',
};

const footerStyle = {
  fontSize: '13px',
  lineHeight: '20px',
  color: '#94a3b8',
  margin: '0',
};

VulnerabilitySummaryEmail.TemplateProps = {
  ...sharedTemplateProps,
  summaryLabel: '{{.SummaryLabel}}',
  overview: '{{.Overview}}',
  fixableCount: '{{.FixableCount}}',
  severityBreakdown: '{{.SeverityBreakdown}}',
  sampleCVEs: '{{.SampleCVEs}}',
};

VulnerabilitySummaryEmail.PreviewProps = {
  ...sharedPreviewProps,
  summaryLabel: 'Daily Summary - 2026-02-10',
  overview: '12 image(s) scanned, 4 with fixable vulnerabilities',
  fixableCount: '19 fixable vulnerability record(s)',
  severityBreakdown: 'Critical:2 High:9 Medium:6 Low:2 Unknown:0',
  sampleCVEs: 'CVE-2025-1234, CVE-2025-5678, CVE-2026-0001',
};
