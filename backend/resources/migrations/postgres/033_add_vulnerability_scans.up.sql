-- Add vulnerability_scans table for storing vulnerability scan results
CREATE TABLE IF NOT EXISTS vulnerability_scans (
    id TEXT PRIMARY KEY,
    image_name TEXT NOT NULL,
    status TEXT NOT NULL DEFAULT 'pending',
    scan_time TIMESTAMP NOT NULL,
    duration BIGINT NOT NULL DEFAULT 0,
    critical_count INTEGER NOT NULL DEFAULT 0,
    high_count INTEGER NOT NULL DEFAULT 0,
    medium_count INTEGER NOT NULL DEFAULT 0,
    low_count INTEGER NOT NULL DEFAULT 0,
    unknown_count INTEGER NOT NULL DEFAULT 0,
    total_count INTEGER NOT NULL DEFAULT 0,
    vulnerabilities TEXT,
    error TEXT,
    scanner_version TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP
);

-- Create indexes for efficient querying
CREATE INDEX IF NOT EXISTS idx_vulnerability_scans_status ON vulnerability_scans(status);
CREATE INDEX IF NOT EXISTS idx_vulnerability_scans_scan_time ON vulnerability_scans(scan_time);
